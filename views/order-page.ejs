<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order <%= product.brand %> - GASS Topup</title>
    <link rel="stylesheet" href="/css/style.css"> 
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="navbar-brand">GASS<span>TOPUP</span></a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li><a href="/cek">Cek Pesanan</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="order-product-header card">
            <img src="<%= product.imageUrl || 'https://via.placeholder.com/300x400.png/161B22/c9d1d9?text=No+Image' %>" alt="<%= product.brand %>">
            <div>
                <h1><%= product.brand %></h1>
                <p>Top up <%= product.category %> cepat dan mudah.</p>
            </div>
        </div>

        <form id="order-form" action="/order" method="POST">
            <div class="order-container">
                <section class="form-section">
                    <div class="card">
                        <div class="card-header"><h2>Lengkapi Data</h2></div>
                        <% if (product.category === 'Games') { %>
                            <div class="form-group"><label for="productId">User ID (Zone ID)</label><input type="text" id="productId" name="productId" placeholder="Contoh: 12345678 (1234)" required></div>
                        <% } else if (product.category === 'Pulsa' || product.category === 'Paket Data') { %>
                            <div class="form-group"><label for="productId">Nomor HP Tujuan</label><input type="tel" id="productId" name="productId" placeholder="Contoh: 081234567890" required></div>
                        <% } else if (product.category === 'PLN') { %>
                            <div class="form-group"><label for="productId">Nomor Meter / ID Pelanggan PLN</label><input type="text" id="productId" name="productId" placeholder="Masukkan nomor meter Anda" required></div>
                        <% } else { %>
                            <div class="form-group"><label for="productId">ID Pelanggan / Nomor Tujuan</label><input type="text" id="productId" name="productId" required></div>
                        <% } %>
                        <div class="form-group">
                            <label for="phone">Nomor WhatsApp</label>
                            <input type="tel" id="phone" name="phone" placeholder="Untuk menerima bukti transaksi" required>
                        </div>
                    </div>
                </section>
                <section class="denomination-section">
                    <div class="card">
                        <div class="card-header"><h2>Pilih Nominal</h2></div>
                        <% sortedGroupNames.forEach(category => { %>
                            <% if (groupCount > 1) { %>
                                <h3 class="denomination-category-title"><%= category %></h3>
                            <% } %>
                            <div class="denomination-grid">
                                <% groupedDenominations[category].forEach(denom => { %>
                                    <div class="denomination-item" data-name="<%= denom.product_name %>" data-price="<%= denom.selling_price %>">
                                        <div class="denomination-name"><%= denom.product_name %></div>
                                        <div class="denomination-price">Rp <%= denom.selling_price.toLocaleString('id-ID') %></div>
                                    </div>
                                <% }) %>
                            </div>
                        <% }) %>
                    </div>
                </section>
            </div>
            
            <input type="hidden" name="product" id="selected-product-name">
            <input type="hidden" name="payment" value="QRIS">

            <div class="checkout-section card">
                <div class="order-summary">
                    <span>Total</span>
                    <span id="total-price">Rp 0</span>
                </div>
                <button type="submit" class="btn-order">Beli Sekarang</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const denominationItems = document.querySelectorAll('.denomination-item');
            const selectedProductNameInput = document.getElementById('selected-product-name');
            const totalPriceDisplay = document.getElementById('total-price');

            denominationItems.forEach(item => {
                item.addEventListener('click', () => {
                    denominationItems.forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    // PERUBAHAN DI SINI: Ambil harga dari 'data-price' yang sudah harga jual
                    const price = parseInt(item.dataset.price);
                    selectedProductNameInput.value = item.dataset.name;
                    totalPriceDisplay.innerText = `Rp ${price.toLocaleString('id-ID')}`;
                });
            });

            document.getElementById('order-form').addEventListener('submit', (e) => {
                if (!selectedProductNameInput.value) {
                    e.preventDefault();
                    alert('Silakan pilih nominal terlebih dahulu!');
                }
            });
        });
    </script>
</body>
</html>